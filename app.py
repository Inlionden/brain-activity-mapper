import os
import re
import gradio as gr
import google.generativeai as genai
import numpy as np
import gensim.downloader as api

# --- üí° Gemini Keyword Extraction (No changes needed here) ---
def get_keywords_from_sentence(sentence: str, model) -> list[str]:
    """Uses the Gemini model to extract relevant keywords from a sentence."""
    print(f"‚ñ∂Ô∏è  Generating keywords for: '{sentence}'")
    prompt = f"""
    Analyze the following sentence and extract the most essential keywords related to actions, senses, objects, and concepts.
    Return these keywords as a single line of comma-separated values.
    Do not use formatting like bullet points, numbering, or any explanatory text.

    Sentence: "{sentence}"

    Keywords:
    """
    try:
        response = model.generate_content(prompt, request_options={'timeout': 20})
        keywords = [k.strip().strip("'\"") for k in response.text.strip().split(',')]
        print(f"‚úÖ Keywords extracted: {keywords}")
        return keywords
    except Exception as e:
        print(f"‚ùóÔ∏è Could not generate keywords from Gemini: {e}")
        raise gr.Error(f"Failed to get keywords from Gemini. The API may be unavailable or the request timed out. Details: {e}")


# --- üß† Brain Region Mapping Class (No changes needed here) ---
class BrainRegionMapper:
    """Maps keywords to brain regions using GloVe word embeddings."""
    def __init__(self, glove_model_name='glove-wiki-gigaword-100'):
        self.region_data = {
            "Visual Area": {"keywords": ["vision", "see", "light", "color", "shape", "pattern", "visual"], "lobe": "Occipital Lobe", "color": "#BCC6D9"},
            "Association Area": {"keywords": ["memory", "meaning", "recognition", "understanding", "integration"], "lobe": "Temporal Lobe", "color": "#2C562D"},
            "Motor Function Area": {"keywords": ["move", "action", "hand", "body", "walk", "control", "physical"], "lobe": "Parietal Lobe", "color": "#EDDE4B"},
            "Broca's Area": {"keywords": ["speak", "talk", "language", "production", "speech", "words"], "lobe": "Frontal Lobe", "color": "#BF445D"},
            "Auditory Area": {"keywords": ["hear", "sound", "listen", "noise", "music", "auditory"], "lobe": "Temporal Lobe", "color": "#CADE5F"},
            "Sensory Area": {"keywords": ["touch", "feel", "sensation", "pain", "temperature", "pressure"], "lobe": "Parietal Lobe", "color": "#58B7DD"},
            "Somatosensory Association Area": {"keywords": ["sense", "object", "recognition", "texture", "shape", "integration"], "lobe": "Parietal Lobe", "color": "#6FECEB"},
            "Wernicke's Area": {"keywords": ["understand", "comprehension", "language", "meaning", "words"], "lobe": "Temporal/Parietal Junction", "color": "#D98C81"},
            "Motor Function Area (Eye Movement)": {"keywords": ["look", "eye", "gaze", "scan", "follow", "sight"], "lobe": "Frontal Lobe", "color": "#813CC8"},
            "Higher Mental Functions": {"keywords": ["think", "plan", "decision", "reasoning", "problem", "solve", "focus", "personality"], "lobe": "Frontal Lobe", "color": "#BF44A5"},
            "Motor Functions (Cerebellum)": {"keywords": ["balance", "coordination", "movement", "smooth", "posture", "skill"], "lobe": "Cerebellum", "color": "#8E513D"}
        }
        print("\nLoading GloVe model... (This may take a few minutes on first download)")
        self.word_vectors = api.load(glove_model_name)
        self.vector_dim = self.word_vectors.vector_size
        self.region_vectors = self._create_region_vectors()
        print("‚úÖ GloVe model loaded successfully.")
    def _get_vector(self, word):
        try: return self.word_vectors[word.lower()]
        except KeyError: return np.zeros(self.vector_dim)
    def _create_region_vectors(self):
        vectors = {}
        for region, data in self.region_data.items():
            word_vecs = [self._get_vector(w) for w in data["keywords"] if np.any(self._get_vector(w))]
            region_vec = np.mean(word_vecs, axis=0) if word_vecs else np.zeros(self.vector_dim)
            norm = np.linalg.norm(region_vec)
            vectors[region] = region_vec / norm if norm != 0 else region_vec
        return vectors
    def get_most_activated_regions(self, keywords, top_n=3):
        vecs = [self._get_vector(w) for w in keywords if np.any(self._get_vector(w))]
        if not vecs: return "No valid keywords found in the embedding model. Try using more common words."
        input_vec = np.mean(vecs, axis=0)
        norm = np.linalg.norm(input_vec)
        input_vec = input_vec / norm if norm != 0 else input_vec
        if np.all(input_vec == 0): return "Could not create a meaningful vector from the keywords."
        similarities = {r: np.dot(v, input_vec) for r, v in self.region_vectors.items()}
        sorted_regions = sorted(similarities.items(), key=lambda item: item[1], reverse=True)
        results = []
        for name, score in sorted_regions[:top_n]:
            info = self.region_data[name]
            results.append({"region": name, "lobe": info["lobe"], "color": info["color"], "similarity_score": float(score)})
        return results

# --- üöÄ SVG Transformation and Components ---

def transform_svg_paths(shapes_dict, target_width, target_height, padding=20):
    """
    Scales and translates SVG path data to fit within a target viewbox.
    """
    all_coords = []
    # Regex to find all numbers (including decimals and negatives)
    number_re = re.compile(r"[-+]?\d*\.?\d+")
    
    # 1. Extract all coordinates from all paths
    for path_str in shapes_dict.values():
        numbers = [float(n) for n in number_re.findall(path_str)]
        # Group into (x, y) pairs
        all_coords.extend(zip(numbers[::2], numbers[1::2]))
        
    if not all_coords:
        return shapes_dict

    # 2. Find the bounding box of the original drawing
    min_x = min(c[0] for c in all_coords)
    max_x = max(c[0] for c in all_coords)
    min_y = min(c[1] for c in all_coords)
    max_y = max(c[1] for c in all_coords)
    
    orig_width = max_x - min_x
    orig_height = max_y - min_y
    
    # 3. Calculate scaling factor to fit into the target, maintaining aspect ratio
    scale_x = (target_width - padding * 2) / orig_width
    scale_y = (target_height - padding * 2) / orig_height
    scale_factor = min(scale_x, scale_y)
    
    # 4. Calculate offsets to center the scaled drawing
    new_width = orig_width * scale_factor
    new_height = orig_height * scale_factor
    x_offset = (target_width - new_width) / 2
    y_offset = (target_height - new_height) / 2
    
    # 5. Transform each path
    new_shapes = {}
    for name, path_str in shapes_dict.items():
        # Clean up potential "d="d=" typo
        path_str_cleaned = re.sub(r'd="d="', 'd="', path_str, flags=re.IGNORECASE)
        
        # Function to apply transformation to each number found
        def repl(match):
            nonlocal is_x
            val = float(match.group(0))
            if is_x:
                new_val = (val - min_x) * scale_factor + x_offset
            else:
                new_val = (val - min_y) * scale_factor + y_offset
            is_x = not is_x # Flip for the next coordinate
            return f"{new_val:.2f}"

        is_x = True # First number in a path is always X
        new_path_str = number_re.sub(repl, path_str_cleaned)
        new_shapes[name] = new_path_str
        
    return new_shapes

# --- Define SVG constants and original, large-scale paths ---
SVG_HEADER = '<svg viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">'
SVG_FOOTER = '</svg>'
# This outline is already in the correct coordinate system
BRAIN_OUTLINE = '<path d="M200,10 C100,10 50,100 50,180 C50,260 120,300 200,290 C280,300 350,260 350,180 C350,100 300,10 200,10 Z" fill="none" stroke="#aaa" stroke-width="1.5"/>'

# Your original, large-scale SVG path data
ORIGINAL_SHAPES = {
    "Higher Mental Functions": '''<path d="d="
M370.053040,502.059113 
	C369.228638,511.567108 364.840302,519.175842 357.898865,525.577942 
	C351.975983,531.040588 345.698547,536.290039 340.722260,542.544250 
	C337.693451,546.350830 335.351837,551.880798 335.342590,556.641724 
	C335.328247,564.051086 332.404602,570.451416 330.850586,577.294922 
	C329.512695,583.186401 327.689789,588.972168 325.959412,594.768250 
	C325.104126,597.633179 323.974030,600.416077 322.898682,603.632690 
	C306.008026,602.893005 289.188812,601.728577 272.364624,600.640198 
	C268.214172,600.371765 264.035095,600.077576 259.891144,600.269653 
	C249.139969,600.768188 239.095261,597.867798 229.083221,594.509399 
	C223.230042,592.545959 217.069000,591.372131 211.413712,588.976196 
	C202.278198,585.105713 191.667053,581.923218 187.222870,572.539917 
	C183.825287,565.366455 179.102524,566.108643 173.326309,564.836548 
	C163.145264,562.594482 152.080994,561.908203 144.079636,553.456238 
	C142.480576,551.767090 139.605377,550.831543 137.179764,550.463501 
	C129.408569,549.284424 122.298706,546.605225 116.400169,541.461853 
	C111.390251,537.093323 106.776161,532.252991 105.862206,525.107910 
	C105.205124,519.971069 104.380440,514.855835 103.702896,509.721405 
	C103.574699,508.749878 103.390770,507.402161 103.903503,506.789551 
	C108.506500,501.289154 103.449806,498.160858 101.086922,494.265686 
	C96.586296,486.846344 90.944939,479.782440 90.911049,470.557129 
	C90.880005,462.105713 90.741806,453.547974 91.951500,445.226166 
	C93.413284,435.170105 95.531837,425.082214 98.660362,415.427490 
	C102.708282,402.935394 108.057770,390.866455 112.802643,378.598236 
	C115.586639,371.399994 117.984299,364.036194 121.090858,356.982544 
	C125.892845,346.079315 131.212296,335.405121 136.188187,324.576721 
	C138.054398,320.515533 139.547287,316.283997 141.257416,312.149536 
	C143.580399,306.533447 146.302643,301.051361 148.178802,295.291992 
	C149.539856,291.113831 151.033493,286.351379 150.274017,282.256409 
	C149.123901,276.055267 152.772461,271.263519 153.147369,265.781555 
	C153.704498,257.634705 159.469284,252.732422 163.831070,247.130981 
	C168.291763,241.402527 173.505707,235.999207 179.274780,231.619064 
	C186.037338,226.484680 193.961411,222.911377 201.007843,218.112106 
	C210.788391,211.450653 220.393478,204.500961 229.747711,197.253906 
	C237.145157,191.522858 244.051544,185.157990 251.559891,179.338699 
	C252.149673,180.555374 252.030777,181.996475 252.612732,182.383377 
	C257.359802,185.539474 262.101868,188.752792 267.119476,191.436371 
	C271.048462,193.537735 275.570679,194.597992 276.602600,199.943481 
	C276.765686,200.788544 278.064514,201.675797 279.030609,202.060837 
	C284.180176,204.113083 289.408844,205.965744 294.575348,207.976868 
	C299.543457,209.910767 304.650970,211.611084 309.334747,214.097000 
	C311.588654,215.293274 312.856476,218.222809 314.835785,220.085999 
	C319.495758,224.472595 324.522400,228.485703 329.005646,233.038925 
	C332.770294,236.862381 335.337555,241.504486 341.075714,243.648834 
	C343.424072,244.526398 344.375458,250.044830 345.233978,253.626633 
	C345.664764,255.423737 343.959869,257.651062 344.111694,259.614960 
	C344.369385,262.947723 345.901855,266.229340 345.882294,269.526398 
	C345.839111,276.806183 346.776794,283.996979 344.276154,291.378296 
	C341.421448,299.804749 340.361877,308.851440 338.694061,317.661133 
	C338.144470,320.564056 338.715546,323.772797 337.766754,326.489929 
	C334.072052,337.070648 329.972900,347.510162 325.945618,358.385223 
	C319.584778,360.796631 313.238556,362.650635 307.045532,364.922241 
	C303.621490,366.178162 300.112518,367.684967 297.243408,369.868958 
	C291.572174,374.185944 285.937134,378.683472 281.001129,383.795776 
	C276.156281,388.813568 272.899994,395.007233 271.891602,403.000000 
	C276.837677,403.000000 281.302032,402.657745 285.689209,403.092987 
	C290.396881,403.559998 295.234589,404.195465 299.646027,405.783722 
	C304.798096,407.638580 309.570251,410.565338 314.468536,413.101837 
	C317.181183,414.506561 320.851532,415.405396 322.292816,417.674103 
	C326.936981,424.984558 335.019379,430.181305 336.046417,439.778503 
	C336.384979,442.942200 337.404266,446.028625 338.023987,449.167816 
	C338.790192,453.049164 339.110718,457.056396 340.256317,460.816559 
	C342.270355,467.427307 345.188477,473.781952 346.917267,480.453888 
	C348.187927,485.357605 351.047607,488.518829 354.853607,491.281036 
	C356.277771,492.314606 357.605530,493.482941 359.046356,494.491089 
	C362.694397,497.043610 366.381561,499.540131 370.053040,502.059113 
z"/>
<path fill="#58B7DD" opacity="1.100000" stroke="none" 
	d="
M935.884766,572.163879 
	C934.219055,571.967163 932.551758,571.591125 930.887939,571.605835 
	C924.776794,571.659607 918.533142,572.670227 912.599365,571.711731 
	C907.998169,570.968506 903.977600,567.011841 899.359070,565.917114 
	C889.303894,563.533752 880.907471,557.658447 871.666504,553.627136 
	C866.484070,551.366394 862.357788,546.684814 857.107666,542.920288 
	C855.248718,541.292480 854.135559,539.740356 852.802246,538.408691 
	C851.101624,536.710205 848.643250,535.513794 847.534912,533.529358 
	C844.728088,528.503845 842.045898,523.316895 840.134399,517.904846 
	C837.310730,509.910034 831.446716,502.426575 834.973083,493.072510 
	C835.081848,492.783905 835.068848,492.369751 834.946533,492.085663 
	C833.059875,487.702454 831.145813,483.331085 828.915161,478.216705 
	C830.954651,477.412415 832.730103,476.301025 834.622559,476.040894 
	C841.009705,475.162964 847.509644,474.972473 853.833496,473.801025 
	C862.239380,472.243927 870.465942,469.723114 878.868530,468.142792 
	C889.633423,466.118225 900.539246,464.842224 911.303589,462.814880 
	C918.916321,461.381104 926.574341,459.774048 932.005432,453.247986 
	C938.515625,445.425507 938.716980,435.542969 940.749634,426.361816 
	C941.565796,422.675201 939.693726,418.424652 939.203613,414.411407 
	C937.979675,404.388397 936.631226,394.556702 932.355225,385.082458 
	C927.167480,373.588043 923.293945,361.496857 918.935425,349.633087 
	C915.921387,341.429169 912.989502,333.193726 910.135620,324.932739 
	C908.433167,320.004669 907.094788,314.949036 905.339172,310.041473 
	C902.567993,302.294922 901.151367,293.904877 895.103149,287.645386 
	C895.024536,287.564056 895.110901,287.323334 895.495239,287.098206 
	C898.164490,285.465088 900.567200,284.023407 902.713196,282.267914 
	C904.054016,281.171082 904.865112,279.443878 906.159119,278.269867 
	C913.008118,272.056335 919.264160,265.314331 923.507690,257.049561 
	C926.693665,250.844482 928.163208,243.404388 932.456909,238.220230 
	C936.847107,232.919525 937.944153,227.331055 938.869690,221.255646 
	C939.578003,216.605545 940.043884,211.918488 940.652588,206.963028 
	C943.262085,206.963028 944.898071,206.903381 946.527222,206.983383 
	C947.669312,207.039474 948.867188,207.102997 949.927612,207.479858 
	C954.115906,208.968399 953.356750,206.354691 952.948059,203.691711 
	C952.989075,203.226776 953.017761,203.042023 953.046509,202.857254 
	C953.046509,202.857254 953.512085,202.903580 953.890259,203.280853 
	C955.795593,204.492142 957.322815,205.326141 958.850037,206.160141 
	C966.948608,211.355850 973.135925,218.341660 978.439270,226.313766 
	C980.259460,229.050018 982.801208,231.958084 985.696533,233.219543 
	C1002.196655,240.408432 1015.599854,251.705856 1028.273560,264.086578 
	C1034.387695,270.059326 1041.290771,275.408386 1046.494141,282.085938 
	C1054.115112,291.866028 1061.735474,301.687164 1066.377808,313.618469 
	C1070.130371,323.262756 1072.179565,333.009521 1073.127808,343.149933 
	C1073.826294,350.618988 1074.300049,358.119293 1075.340942,365.540131 
	C1075.666016,367.857574 1077.114502,370.326294 1078.734253,372.099457 
	C1085.529541,379.538635 1090.214111,387.859375 1093.336426,397.601166 
	C1098.643188,414.158264 1099.971924,430.975800 1099.948120,448.146545 
	C1099.933472,458.724243 1100.422485,469.328125 1101.267090,479.873657 
	C1101.973755,488.697937 1103.525146,497.454559 1104.822266,507.080048 
	C1104.967529,512.283752 1104.992920,516.648499 1105.018433,521.013245 
	C1104.818481,531.043518 1100.821533,540.018066 1095.444458,547.929932 
	C1090.877319,554.649963 1084.493408,560.212158 1078.525513,565.877991 
	C1074.104004,570.075928 1069.059692,573.618103 1063.733032,577.733276 
	C1062.285645,576.619690 1061.398071,575.225037 1061.072388,574.713257 
	C1056.707397,575.183228 1052.449219,576.143616 1048.230469,575.992859 
	C1039.064575,575.665344 1029.926270,574.630920 1020.763184,574.139648 
	C1006.162170,573.356628 991.550049,572.780762 976.574158,572.018799 
	C974.524597,571.404907 972.851379,570.474365 971.161072,570.442139 
	C961.108093,570.250122 951.050293,570.191589 940.996704,570.309326 
	C939.786377,570.323486 938.591553,571.670166 937.020996,572.291504 
	C936.396545,572.177063 936.140686,572.170471 935.884766,572.163879 Z"/>''',
    "Broca's Area": '''<path d="
M493.569031,261.399841 
	C493.787231,262.359161 494.225922,263.800201 493.700958,264.636017 
	C490.933685,269.041779 490.466492,273.957794 489.603516,278.924500 
	C487.711334,289.814545 483.813385,300.043976 478.619080,309.870667 
	C476.150421,314.540894 475.090637,319.944977 473.282013,324.976868 
	C467.527313,340.987488 468.075989,357.652039 468.224762,374.249237 
	C468.309387,383.687897 469.067322,393.121735 469.101501,402.559296 
	C469.127869,409.830688 468.656464,417.116486 468.106537,424.373108 
	C467.730103,429.340515 466.838348,434.268860 466.178040,439.699829 
	C462.673981,445.377838 457.166412,448.309631 452.289825,446.583008 
	C445.251404,453.316406 438.630035,459.608673 432.076721,465.971100 
	C431.210999,466.811523 430.113098,468.012024 430.117523,469.041504 
	C430.133270,472.710083 427.552704,473.820648 425.083832,475.607178 
	C421.541107,478.170746 418.742706,481.743500 415.284668,484.448425 
	C410.834686,487.929199 406.101471,491.062408 401.355042,494.136505 
	C400.466461,494.711975 398.924591,494.194916 397.715363,494.382721 
	C396.520569,494.568298 395.260132,494.810394 394.210052,495.369080 
	C388.363373,498.479401 382.696716,501.974030 376.665985,504.657349 
	C375.308868,505.261200 372.746979,503.157257 370.396362,502.179474 
	C366.381561,499.540131 362.694397,497.043610 359.046356,494.491089 
	C357.605530,493.482941 356.277771,492.314606 354.853607,491.281036 
	C351.047607,488.518829 348.187927,485.357605 346.917267,480.453888 
	C345.188477,473.781952 342.270355,467.427307 340.256317,460.816559 
	C339.110718,457.056396 338.790192,453.049164 338.023987,449.167816 
	C337.404266,446.028625 336.384979,442.942200 336.046417,439.778503 
	C335.019379,430.181305 326.936981,424.984558 322.292816,417.674103 
	C320.851532,415.405396 317.181183,414.506561 314.468536,413.101837 
	C309.570251,410.565338 304.798096,407.638580 299.646027,405.783722 
	C295.234589,404.195465 290.396881,403.559998 285.689209,403.092987 
	C281.302032,402.657745 276.837677,403.000000 271.891602,403.000000 
	C272.899994,395.007233 276.156281,388.813568 281.001129,383.795776 
	C285.937134,378.683472 291.572174,374.185944 297.243408,369.868958 
	C300.112518,367.684967 303.621490,366.178162 307.045532,364.922241 
	C313.238556,362.650635 319.584778,360.796631 325.945618,358.385254 
	C332.417450,357.999634 338.810760,357.976959 345.203888,358.001984 
	C349.055939,358.017059 351.448212,356.331726 351.749939,352.351990 
	C352.559692,341.672241 356.854767,332.170044 362.913086,323.739105 
	C366.718079,318.444000 372.035034,314.075195 377.202606,309.954071 
	C386.799225,302.300751 398.528717,299.664703 410.208527,297.083130 
	C420.419067,294.826294 428.231689,289.099640 433.863892,280.360687 
	C439.070526,272.282074 446.139587,266.108978 455.213470,263.448212 
	C459.511322,262.187927 464.867676,263.553772 469.500092,264.709381 
	C473.694061,265.755676 477.440430,268.504547 481.603027,269.798798 
	C484.567841,270.720612 487.497986,269.956787 488.514221,266.095978 
	C489.009064,264.216156 489.478149,261.103882 492.649109,264.561890 
	C492.909576,263.454102 493.127258,262.528229 493.569031,261.399841 Z"/>''',
    "Motor Function Area (Eye Movement)": '''<path d="
M326.024200,358.002197 
	C329.972900,347.510162 334.072052,337.070648 337.766754,326.489929 
	C338.715546,323.772797 338.144470,320.564056 338.694061,317.661133 
	C340.361877,308.851440 341.421448,299.804749 344.276154,291.378296 
	C346.776794,283.996979 345.839111,276.806183 345.882294,269.526398 
	C345.901855,266.229340 344.369385,262.947723 344.111694,259.614960 
	C343.959869,257.651062 345.664764,255.423737 345.233978,253.626633 
	C344.375458,250.044830 343.424072,244.526398 341.075714,243.648834 
	C335.337555,241.504486 332.770294,236.862381 329.005646,233.038925 
	C324.522400,228.485703 319.495758,224.472595 314.835785,220.085999 
	C312.856476,218.222809 311.588654,215.293274 309.334747,214.097000 
	C304.650970,211.611084 299.543457,209.910767 294.575348,207.976868 
	C289.408844,205.965744 284.180176,204.113083 279.030609,202.060837 
	C278.064514,201.675797 276.765686,200.788544 276.602600,199.943481 
	C275.570679,194.597992 271.048462,193.537735 267.119476,191.436371 
	C262.101868,188.752792 257.359802,185.539474 252.612732,182.383377 
	C252.030777,181.996475 252.149673,180.555374 251.890442,179.202148 
	C259.494476,172.876419 266.963928,166.686646 274.852203,161.086838 
	C287.427277,152.159943 300.057922,143.271622 313.097473,135.053085 
	C321.439117,129.795502 330.414001,125.455208 339.400818,121.351540 
	C343.021576,119.698196 347.437500,119.801971 351.482971,119.059265 
	C357.528320,117.949387 363.778870,117.438965 369.559113,115.519936 
	C379.129211,112.342667 388.365021,108.170013 397.799957,104.569405 
	C402.709839,102.695641 407.802338,101.300079 412.710815,99.422966 
	C424.017975,95.098869 435.241974,90.557129 446.556549,86.253090 
	C448.202393,85.627007 450.204437,86.012779 451.967468,85.607567 
	C466.047821,82.371346 480.102051,79.021507 494.182098,75.783989 
	C500.170563,74.407028 506.155273,72.899689 512.223450,72.008278 
	C523.204041,70.395226 534.245789,69.198051 545.262451,67.830772 
	C553.482788,66.810555 561.678162,65.346268 569.929993,64.876915 
	C584.866272,64.027374 599.784241,64.077667 613.989685,72.389084 
	C617.307617,72.908264 619.905090,73.222481 622.502930,73.534836 
	C616.832458,73.972847 615.297974,75.695839 614.612000,81.265388 
	C614.209839,84.530869 614.131897,88.790024 612.110596,90.700615 
	C608.101135,94.490540 602.636414,96.683418 598.158997,100.049667 
	C592.046265,104.645378 586.204651,109.617188 580.416321,114.623726 
	C576.153503,118.310722 572.807251,122.682907 569.618896,127.470848 
	C565.656372,133.421356 562.293884,139.493164 559.807495,146.092728 
	C557.825623,151.353226 556.257141,156.768219 554.438904,162.091995 
	C553.195068,165.733963 552.008728,169.410522 550.494263,172.941910 
	C547.517151,179.883591 544.600220,186.757401 544.570862,194.558517 
	C544.561951,196.928284 543.835938,199.913589 542.296143,201.526520 
	C539.380005,204.581039 535.722717,206.969620 532.211487,209.401077 
	C529.422729,211.332199 526.380127,212.894180 523.473083,214.657730 
	C520.248230,216.614044 515.904053,217.866867 514.041626,220.725418 
	C506.796631,231.845627 500.395569,243.497116 496.596680,256.377258 
	C496.085938,258.108948 494.748016,259.596680 493.569031,261.399841 
	C493.127258,262.528229 492.909576,263.454102 492.649109,264.561890 
	C489.478149,261.103882 489.009064,264.216156 488.514221,266.095978 
	C487.497986,269.956787 484.567841,270.720612 481.603027,269.798798 
	C477.440430,268.504547 473.694061,265.755676 469.500092,264.709381 
	C464.867676,263.553772 459.511322,262.187927 455.213470,263.448212 
	C446.139587,266.108978 439.070526,272.282074 433.863892,280.360687 
	C428.231689,289.099640 420.419067,294.826294 410.208527,297.083130 
	C398.528717,299.664703 386.799225,302.300751 377.202606,309.954071 
	C372.035034,314.075195 366.718079,318.444000 362.913086,323.739105 
	C356.854767,332.170044 352.559692,341.672241 351.749939,352.351990 
	C351.448212,356.331726 349.055939,358.017059 345.203888,358.001984 
	C338.810760,357.976959 332.417450,357.999634 326.024200,358.002197 Z"/>''',
    "Motor Function Area": '''<path d="
M707.761658,109.742775 
	C702.120117,111.706589 696.383606,113.437233 690.858154,115.686241 
	C681.425964,119.525398 672.267761,124.071175 662.730957,127.610016 
	C653.229736,131.135635 645.614258,137.097366 637.744690,143.228165 
	C630.378662,148.966751 625.889954,156.151321 621.808105,164.081726 
	C619.204651,169.139923 615.996887,173.884567 613.132324,178.811798 
	C611.317139,181.933990 609.432495,185.040726 607.931519,188.315933 
	C603.805603,197.318710 599.925781,206.433945 595.835327,215.453323 
	C591.719849,224.528030 587.726685,233.672867 583.202576,242.543564 
	C578.721313,251.330338 573.364136,259.670959 568.897400,268.464417 
	C562.862244,280.345703 558.717224,292.274475 560.477539,306.497498 
	C562.074219,319.398682 566.840210,330.912567 570.652588,342.923340 
	C570.911194,343.737915 570.529358,344.826050 570.241272,345.721283 
	C570.016235,346.420563 568.982117,347.209961 569.146790,347.631683 
	C571.745117,354.286346 568.384644,360.552246 567.858948,366.969055 
	C567.311951,373.647278 562.534119,378.313568 558.142578,382.782288 
	C552.185791,388.843689 545.703857,394.017700 537.470825,397.320435 
	C532.828918,399.182587 529.187622,404.035431 525.705688,408.067871 
	C524.135742,409.885986 523.387146,412.924622 526.460327,415.186035 
	C527.218201,415.743683 526.831848,417.856232 526.912720,419.624268 
	C524.971130,422.318604 523.088318,424.642700 521.044434,427.165558 
	C519.726013,425.174835 518.570557,423.430176 517.167786,421.312164 
	C517.059937,423.232574 516.972839,424.783478 516.852905,426.918182 
	C508.117065,429.678345 499.190765,432.231079 490.478271,435.376038 
	C486.708740,436.736725 483.519379,439.641815 479.806793,441.243561 
	C476.930023,442.484680 473.671448,442.958923 470.529724,443.364929 
	C469.925201,443.443054 469.075226,441.622131 467.852142,441.643494 
	C467.355103,441.342438 466.858093,441.041382 466.269043,439.977478 
	C466.838348,434.268860 467.730103,429.340515 468.106537,424.373108 
	C468.656464,417.116486 469.127869,409.830688 469.101501,402.559296 
	C469.067322,393.121735 468.309387,383.687897 468.224762,374.249237 
	C468.075989,357.652039 467.527313,340.987488 473.282013,324.976868 
	C475.090637,319.944977 476.150421,314.540894 478.619080,309.870667 
	C483.813385,300.043976 487.711334,289.814545 489.603516,278.924500 
	C490.466492,273.957794 490.933685,269.041779 493.700958,264.636017 
	C494.225922,263.800201 493.787231,262.359161 493.793152,261.197357 
	C494.748016,259.596680 496.085938,258.108948 496.596680,256.377258 
	C500.395569,243.497116 506.796631,231.845627 514.041626,220.725418 
	C515.904053,217.866867 520.248230,216.614044 523.473083,214.657730 
	C526.380127,212.894180 529.422729,211.332199 532.211487,209.401077 
	C535.722717,206.969620 539.380005,204.581039 542.296143,201.526520 
	C543.835938,199.913589 544.561951,196.928284 544.570862,194.558517 
	C544.600220,186.757401 547.517151,179.883591 550.494263,172.941910 
	C552.008728,169.410522 553.195068,165.733963 554.438904,162.091995 
	C556.257141,156.768219 557.825623,151.353226 559.807495,146.092728 
	C562.293884,139.493164 565.656372,133.421356 569.618896,127.470848 
	C572.807251,122.682907 576.153503,118.310722 580.416321,114.623726 
	C586.204651,109.617188 592.046265,104.645378 598.158997,100.049667 
	C602.636414,96.683418 608.101135,94.490540 612.110596,90.700615 
	C614.131897,88.790024 614.209839,84.530869 614.612000,81.265388 
	C615.297974,75.695839 616.832458,73.972847 622.502930,73.534836 
	C619.905090,73.222481 617.307617,72.908264 614.387329,72.389206 
	C620.088135,70.800217 626.111755,69.416054 633.028442,68.045715 
	C641.957031,68.014992 649.992371,67.970444 658.027771,67.925896 
	C668.745300,68.213150 678.275085,72.667572 687.547424,77.231354 
	C692.702515,79.768654 697.163940,84.010971 701.397034,88.051514 
	C706.745117,93.156288 711.542236,98.838326 716.405396,104.684357 
	C713.409790,106.645821 710.585693,108.194290 707.761658,109.742775 Z"/>''',
    "Sensory Area": '''<path d="
M935.884766,572.163879 
	C934.219055,571.967163 932.551758,571.591125 930.887939,571.605835 
	C924.776794,571.659607 918.533142,572.670227 912.599365,571.711731 
	C907.998169,570.968506 903.977600,567.011841 899.359070,565.917114 
	C889.303894,563.533752 880.907471,557.658447 871.666504,553.627136 
	C866.484070,551.366394 862.357788,546.684814 857.107666,542.920288 
	C855.248718,541.292480 854.135559,539.740356 852.802246,538.408691 
	C851.101624,536.710205 848.643250,535.513794 847.534912,533.529358 
	C844.728088,528.503845 842.045898,523.316895 840.134399,517.904846 
	C837.310730,509.910034 831.446716,502.426575 834.973083,493.072510 
	C835.081848,492.783905 835.068848,492.369751 834.946533,492.085663 
	C833.059875,487.702454 831.145813,483.331085 828.915161,478.216705 
	C830.954651,477.412415 832.730103,476.301025 834.622559,476.040894 
	C841.009705,475.162964 847.509644,474.972473 853.833496,473.801025 
	C862.239380,472.243927 870.465942,469.723114 878.868530,468.142792 
	C889.633423,466.118225 900.539246,464.842224 911.303589,462.814880 
	C918.916321,461.381104 926.574341,459.774048 932.005432,453.247986 
	C938.515625,445.425507 938.716980,435.542969 940.749634,426.361816 
	C941.565796,422.675201 939.693726,418.424652 939.203613,414.411407 
	C937.979675,404.388397 936.631226,394.556702 932.355225,385.082458 
	C927.167480,373.588043 923.293945,361.496857 918.935425,349.633087 
	C915.921387,341.429169 912.989502,333.193726 910.135620,324.932739 
	C908.433167,320.004669 907.094788,314.949036 905.339172,310.041473 
	C902.567993,302.294922 901.151367,293.904877 895.103149,287.645386 
	C895.024536,287.564056 895.110901,287.323334 895.495239,287.098206 
	C898.164490,285.465088 900.567200,284.023407 902.713196,282.267914 
	C904.054016,281.171082 904.865112,279.443878 906.159119,278.269867 
	C913.008118,272.056335 919.264160,265.314331 923.507690,257.049561 
	C926.693665,250.844482 928.163208,243.404388 932.456909,238.220230 
	C936.847107,232.919525 937.944153,227.331055 938.869690,221.255646 
	C939.578003,216.605545 940.043884,211.918488 940.652588,206.963028 
	C943.262085,206.963028 944.898071,206.903381 946.527222,206.983383 
	C947.669312,207.039474 948.867188,207.102997 949.927612,207.479858 
	C954.115906,208.968399 953.356750,206.354691 952.948059,203.691711 
	C952.989075,203.226776 953.017761,203.042023 953.046509,202.857254 
	C953.046509,202.857254 953.512085,202.903580 953.890259,203.280853 
	C955.795593,204.492142 957.322815,205.326141 958.850037,206.160141 
	C966.948608,211.355850 973.135925,218.341660 978.439270,226.313766 
	C980.259460,229.050018 982.801208,231.958084 985.696533,233.219543 
	C1002.196655,240.408432 1015.599854,251.705856 1028.273560,264.086578 
	C1034.387695,270.059326 1041.290771,275.408386 1046.494141,282.085938 
	C1054.115112,291.866028 1061.735474,301.687164 1066.377808,313.618469 
	C1070.130371,323.262756 1072.179565,333.009521 1073.127808,343.149933 
	C1073.826294,350.618988 1074.300049,358.119293 1075.340942,365.540131 
	C1075.666016,367.857574 1077.114502,370.326294 1078.734253,372.099457 
	C1085.529541,379.538635 1090.214111,387.859375 1093.336426,397.601166 
	C1098.643188,414.158264 1099.971924,430.975800 1099.948120,448.146545 
	C1099.933472,458.724243 1100.422485,469.328125 1101.267090,479.873657 
	C1101.973755,488.697937 1103.525146,497.454559 1104.822266,507.080048 
	C1104.967529,512.283752 1104.992920,516.648499 1105.018433,521.013245 
	C1104.818481,531.043518 1100.821533,540.018066 1095.444458,547.929932 
	C1090.877319,554.649963 1084.493408,560.212158 1078.525513,565.877991 
	C1074.104004,570.075928 1069.059692,573.618103 1063.733032,577.733276 
	C1062.285645,576.619690 1061.398071,575.225037 1061.072388,574.713257 
	C1056.707397,575.183228 1052.449219,576.143616 1048.230469,575.992859 
	C1039.064575,575.665344 1029.926270,574.630920 1020.763184,574.139648 
	C1006.162170,573.356628 991.550049,572.780762 976.574158,572.018799 
	C974.524597,571.404907 972.851379,570.474365 971.161072,570.442139 
	C961.108093,570.250122 951.050293,570.191589 940.996704,570.309326 
	C939.786377,570.323486 938.591553,571.670166 937.020996,572.291504 
	C936.396545,572.177063 936.140686,572.170471 935.884766,572.163879 Z"/>''',
    "Somatosensory Association Area": '''<path d="
M568.990906,418.160919 
	C564.665527,418.766937 560.339600,419.368896 556.014893,419.979980 
	C549.463013,420.905762 542.933228,422.078064 536.351196,422.660919 
	C533.288574,422.932098 529.481995,424.887054 527.106018,419.971741 
	C526.831848,417.856232 527.218201,415.743683 526.460327,415.186035 
	C523.387146,412.924622 524.135742,409.885986 525.705688,408.067871 
	C529.187622,404.035431 532.828918,399.182587 537.470825,397.320435 
	C545.703857,394.017700 552.185791,388.843689 558.142578,382.782288 
	C562.534119,378.313568 567.311951,373.647278 567.858948,366.969055 
	C568.384644,360.552246 571.745117,354.286346 569.146790,347.631683 
	C568.982117,347.209961 570.016235,346.420563 570.241272,345.721283 
	C570.529358,344.826050 570.911194,343.737915 570.652588,342.923340 
	C566.840210,330.912567 562.074219,319.398682 560.477539,306.497498 
	C558.717224,292.274475 562.862244,280.345703 568.897400,268.464417 
	C573.364136,259.670959 578.721313,251.330338 583.202576,242.543564 
	C587.726685,233.672867 591.719849,224.528030 595.835327,215.453323 
	C599.925781,206.433945 603.805603,197.318710 607.931519,188.315933 
	C609.432495,185.040726 611.317139,181.933990 613.132324,178.811798 
	C615.996887,173.884567 619.204651,169.139923 621.808105,164.081726 
	C625.889954,156.151321 630.378662,148.966751 637.744690,143.228165 
	C645.614258,137.097366 653.229736,131.135635 662.730957,127.610016 
	C672.267761,124.071175 681.425964,119.525398 690.858154,115.686241 
	C696.383606,113.437233 702.120117,111.706589 708.000610,109.679092 
	C710.009033,109.365158 711.849487,109.343468 713.534424,108.820595 
	C718.066589,107.414185 723.520203,108.522598 726.937500,104.017792 
	C734.156189,102.669525 741.373352,101.312630 748.594849,99.979652 
	C750.203125,99.682785 751.875488,99.639290 753.435852,99.191643 
	C765.152710,95.830162 777.220642,96.295303 789.022888,97.309052 
	C797.915283,98.072853 805.894836,102.621597 812.058167,109.693222 
	C815.218567,113.319244 818.828796,116.553146 822.809448,120.300018 
	C824.571289,121.385300 825.759521,122.134827 826.547607,122.957085 
	C819.546143,124.574020 812.918030,126.013397 806.349792,127.687340 
	C796.800964,130.120865 793.223267,138.193390 789.712708,146.073898 
	C787.948853,150.033356 787.815613,154.940796 785.418091,158.343857 
	C781.918762,163.310806 777.651550,167.862869 770.403625,168.088318 
	C766.372314,168.213715 762.011902,169.456802 758.515320,171.450821 
	C755.612122,173.106430 751.941833,175.171677 751.927246,179.695801 
	C751.924744,180.487213 750.997559,181.240417 750.636169,182.071609 
	C748.349487,187.331512 746.101868,192.608414 743.457520,197.920258 
	C742.360474,199.224762 741.490662,200.428589 740.975708,201.768723 
	C740.401917,203.262299 740.654297,205.682709 739.669495,206.300278 
	C735.992615,208.606094 736.908997,211.857071 736.942200,215.389450 
	C734.282959,221.587143 731.875427,227.494171 729.290039,233.322327 
	C726.874451,238.767578 723.799500,243.965378 721.852539,249.563477 
	C718.405090,259.475769 710.836670,266.399750 704.567017,274.499512 
	C699.779846,278.653595 695.319458,282.815613 690.563599,287.182373 
	C688.803772,288.224640 687.432434,289.405762 685.856689,289.833221 
	C681.685608,290.964600 677.232300,291.269562 673.243530,292.813354 
	C665.857300,295.672211 658.676819,299.084045 651.511780,302.478973 
	C649.509766,303.427521 647.746948,304.995422 646.072632,306.499847 
	C640.641296,311.380249 635.125977,316.186920 629.965881,321.345062 
	C620.777588,330.529846 614.021179,341.072357 613.994202,354.629791 
	C613.979675,361.910553 614.859558,369.195984 614.776123,376.472931 
	C614.676453,385.174652 616.793823,393.301666 619.706543,401.579041 
	C616.024780,403.430023 612.456055,404.904999 608.983398,406.579224 
	C604.101685,408.932800 599.740784,412.551208 593.779175,412.096802 
	C592.225159,411.978363 590.595581,412.747894 589.011230,413.151031 
	C585.328552,414.088135 581.657349,415.070435 577.971924,415.996307 
	C574.985474,416.746674 571.985107,417.441498 568.990906,418.160919 Z"/>''',
    "Auditory Area": '''<path d="
M619.706543,401.579041 
	C622.164062,402.194672 624.428528,403.740753 626.774231,403.875854 
	C633.083862,404.239136 639.512207,404.648254 645.738281,403.841522 
	C654.181519,402.747528 662.663940,401.536743 670.362183,397.035034 
	C676.767273,393.289490 684.241638,391.247681 690.322571,387.102051 
	C699.222534,381.034546 710.313904,377.200775 714.389221,365.478607 
	C716.557434,359.242157 719.113281,353.051239 722.328369,347.306671 
	C723.878174,344.537506 727.193787,341.302643 729.998291,341.005981 
	C735.124573,340.463715 739.819641,337.382843 745.391296,338.792023 
	C747.414978,339.303864 750.182251,337.382050 752.465393,336.272522 
	C761.809998,331.731293 770.983704,326.819183 780.453064,322.561340 
	C785.745667,320.181549 791.447266,318.650269 797.053345,317.047394 
	C801.727417,315.710999 806.482544,314.331543 811.288696,313.863495 
	C817.933044,313.216492 824.658936,313.322662 831.350037,313.318329 
	C832.523376,313.317566 834.007996,314.076569 834.815918,314.967804 
	C837.871338,318.338287 840.796143,321.838409 843.592834,325.427948 
	C845.342285,327.673309 846.571350,330.335205 848.387756,332.515289 
	C854.119873,339.394714 855.706665,347.476929 856.109131,356.120972 
	C856.255615,359.268311 857.762573,362.332886 858.418030,365.483246 
	C858.815857,367.395172 859.139832,369.454071 858.856018,371.351013 
	C858.077881,376.551636 857.220276,381.768555 855.905884,386.852814 
	C854.560181,392.058044 853.064087,397.306244 850.867432,402.191040 
	C847.280823,410.167114 843.226257,417.946503 839.074951,425.650360 
	C836.076660,431.214386 831.464050,435.383484 826.264954,438.965149 
	C824.217957,440.375336 822.249390,442.085632 820.726990,444.035553 
	C816.407410,449.568054 810.484558,451.140991 803.920105,452.140564 
	C799.486450,452.815704 795.240601,454.777008 790.936157,456.237976 
	C779.563049,460.098022 768.297302,464.308716 756.807678,467.780518 
	C748.373779,470.328979 739.708435,472.223572 731.040344,473.842773 
	C725.915771,474.800079 720.519897,474.259918 715.364746,475.111511 
	C709.772766,476.035217 704.376160,478.625702 698.792358,479.011017 
	C687.728455,479.774445 676.593811,479.631195 665.489929,479.574585 
	C663.745178,479.565704 662.076660,477.798340 660.248901,477.289185 
	C658.278137,476.740112 655.778137,475.879944 654.179626,476.614655 
	C649.152527,478.925323 643.927429,478.862396 638.649170,479.379028 
	C634.789001,479.756897 631.059631,481.470825 627.000183,482.858032 
	C619.509827,479.448944 612.480286,475.304138 604.999268,472.273926 
	C600.734680,470.546539 595.738708,470.601135 591.062134,469.922211 
	C587.466125,469.400116 583.813660,469.188416 580.259705,468.473999 
	C575.398071,467.496735 574.225525,463.651184 575.273865,458.008453 
	C576.735962,450.139587 576.985168,442.251343 573.533752,434.483643 
	C571.367554,429.608429 570.465698,424.171448 568.993774,418.573730 
	C571.985107,417.441498 574.985474,416.746674 577.971924,415.996307 
	C581.657349,415.070435 585.328552,414.088135 589.011230,413.151031 
	C590.595581,412.747894 592.225159,411.978363 593.779175,412.096802 
	C599.740784,412.551208 604.101685,408.932800 608.983398,406.579224 
	C612.456055,404.904999 616.024780,403.430023 619.706543,401.579041 Z"/>''',
    "Wernicke's Area": '''<path d="
M619.862549,401.291992 
	C616.793823,393.301666 614.676453,385.174652 614.776123,376.472931 
	C614.859558,369.195984 613.979675,361.910553 613.994202,354.629791 
	C614.021179,341.072357 620.777588,330.529846 629.965881,321.345062 
	C635.125977,316.186920 640.641296,311.380249 646.072632,306.499847 
	C647.746948,304.995422 649.509766,303.427521 651.511780,302.478973 
	C658.676819,299.084045 665.857300,295.672211 673.243530,292.813354 
	C677.232300,291.269562 681.685608,290.964600 685.856689,289.833221 
	C687.432434,289.405762 688.803772,288.224640 690.643066,287.495422 
	C691.329468,287.928680 691.861206,288.574402 691.921265,288.533112 
	C697.300110,284.840393 702.371094,280.845123 704.893738,274.507446 
	C710.836670,266.399750 718.405090,259.475769 721.852539,249.563477 
	C723.799500,243.965378 726.874451,238.767578 729.290039,233.322327 
	C731.875427,227.494171 734.282959,221.587143 737.302612,215.338028 
	C741.610168,212.312820 745.383301,209.664124 749.569336,206.999023 
	C753.648315,205.973236 757.258606,204.602631 760.991638,204.024490 
	C770.840393,202.499207 780.714783,200.579712 790.630981,200.210159 
	C800.255981,199.851486 809.943726,201.255463 819.607239,201.828827 
	C831.535583,202.536530 842.580933,206.080399 852.974365,212.377014 
	C856.666809,214.853851 860.280212,216.985001 863.880554,219.127563 
	C863.867493,219.138992 863.859802,219.172867 863.829895,219.528580 
	C865.164124,220.958008 866.528320,222.031708 867.885986,223.121521 
	C867.879517,223.137634 867.867310,223.170120 867.829834,223.538101 
	C870.207214,227.275986 872.621948,230.645889 875.032471,233.997726 
	C875.028259,233.979660 875.002014,233.953384 875.041565,234.194061 
	C875.227905,234.751740 875.471191,234.950684 875.900635,235.415985 
	C876.963867,238.088455 878.339539,240.292740 878.836792,242.680023 
	C880.448059,250.416229 881.737183,258.219574 883.081787,266.440460 
	C882.039124,274.038055 881.065002,281.192230 879.861755,290.029510 
	C883.038025,288.715454 885.020447,287.895325 887.449463,287.036255 
	C890.304138,287.050568 892.712219,287.103790 895.120300,287.157013 
	C895.110901,287.323334 895.024536,287.564056 895.103149,287.645386 
	C901.151367,293.904877 902.567993,302.294922 905.339172,310.041473 
	C907.094788,314.949036 908.433167,320.004669 910.135620,324.932739 
	C912.989502,333.193726 915.921387,341.429169 918.935425,349.633087 
	C923.293945,361.496857 927.167480,373.588043 932.355225,385.082458 
	C936.631226,394.556702 937.979675,404.388397 939.203613,414.411407 
	C939.693726,418.424652 941.565796,422.675201 940.749634,426.361816 
	C938.716980,435.542969 938.515625,445.425507 932.005432,453.247986 
	C926.574341,459.774048 918.916321,461.381104 911.303589,462.814880 
	C900.539246,464.842224 889.633423,466.118225 878.868530,468.142792 
	C870.465942,469.723114 862.239380,472.243927 853.833496,473.801025 
	C847.509644,474.972473 841.009705,475.162964 834.622559,476.040894 
	C832.730103,476.301025 830.954651,477.412415 828.915161,478.216705 
	C831.145813,483.331085 833.059875,487.702454 834.946533,492.085663 
	C835.068848,492.369751 835.081848,492.783905 834.973083,493.072510 
	C831.446716,502.426575 837.310730,509.910034 840.134399,517.904846 
	C842.045898,523.316895 844.728088,528.503845 847.534912,533.529358 
	C848.643250,535.513794 851.101624,536.710205 852.802246,538.408691 
	C854.135559,539.740356 855.248718,541.292480 856.749817,542.959595 
	C857.296692,547.941040 858.762207,553.201294 853.012634,555.921936 
	C850.980652,556.883423 849.073059,559.516602 846.186768,557.303223 
	C845.786865,556.996582 843.738831,557.910889 843.761292,558.118958 
	C844.219849,562.367981 840.697266,561.279175 838.634216,561.999329 
	C829.097534,565.328247 819.571106,568.692932 809.968811,571.823425 
	C807.038940,572.778625 803.855713,572.926575 800.828186,573.617859 
	C789.222778,576.268311 777.618286,578.361572 765.575745,578.154358 
	C757.388916,578.013489 748.934753,580.873962 741.034241,579.631531 
	C729.768616,577.859863 717.400696,578.555481 707.648865,571.725830 
	C702.090149,567.832764 695.628784,564.201660 692.805481,556.844727 
	C691.592773,553.684753 687.827026,551.561096 685.426636,548.788696 
	C680.442078,543.031738 675.845093,536.919434 670.623047,531.393311 
	C665.043945,525.489441 658.768311,521.407104 649.851135,520.622009 
	C642.474792,519.972595 635.335205,516.168213 628.228149,513.408020 
	C627.116943,512.976501 625.982605,510.563721 626.154785,509.235016 
	C626.772400,504.470734 627.704834,499.711670 628.986572,495.080231 
	C630.016113,491.359985 632.436096,487.710327 627.140564,485.268921 
	C626.897339,485.156769 626.982727,484.331757 627.093506,483.213989 
	C631.059631,481.470825 634.789001,479.756897 638.649170,479.379028 
	C643.927429,478.862396 649.152527,478.925323 654.179626,476.614655 
	C655.778137,475.879944 658.278137,476.740112 660.248901,477.289185 
	C662.076660,477.798340 663.745178,479.565704 665.489929,479.574585 
	C676.593811,479.631195 687.728455,479.774445 698.792358,479.011017 
	C704.376160,478.625702 709.772766,476.035217 715.364746,475.111511 
	C720.519897,474.259918 725.915771,474.800079 731.040344,473.842773 
	C739.708435,472.223572 748.373779,470.328979 756.807678,467.780518 
	C768.297302,464.308716 779.563049,460.098022 790.936157,456.237976 
	C795.240601,454.777008 799.486450,452.815704 803.920105,452.140564 
	C810.484558,451.140991 816.407410,449.568054 820.726990,444.035553 
	C822.249390,442.085632 824.217957,440.375336 826.264954,438.965149 
	C831.464050,435.383484 836.076660,431.214386 839.074951,425.650360 
	C843.226257,417.946503 847.280823,410.167114 850.867432,402.191040 
	C853.064087,397.306244 854.560181,392.058044 855.905884,386.852814 
	C857.220276,381.768555 858.077881,376.551636 858.856018,371.351013 
	C859.139832,369.454071 858.815857,367.395172 858.418030,365.483246 
	C857.762573,362.332886 856.255615,359.268311 856.109131,356.120972 
	C855.706665,347.476929 854.119873,339.394714 848.387756,332.515289 
	C846.571350,330.335205 845.342285,327.673309 843.592834,325.427948 
	C840.796143,321.838409 837.871338,318.338287 834.815918,314.967804 
	C834.007996,314.076569 832.523376,313.317566 831.350037,313.318329 
	C824.658936,313.322662 817.933044,313.216492 811.288696,313.863495 
	C806.482544,314.331543 801.727417,315.710999 797.053345,317.047394 
	C791.447266,318.650269 785.745667,320.181549 780.453064,322.561340 
	C770.983704,326.819183 761.809998,331.731293 752.465393,336.272522 
	C750.182251,337.382050 747.414978,339.303864 745.391296,338.792023 
	C739.819641,337.382843 735.124573,340.463715 729.998291,341.005981 
	C727.193787,341.302643 723.878174,344.537506 722.328369,347.306671 
	C719.113281,353.051239 716.557434,359.242157 714.389221,365.478607 
	C710.313904,377.200775 699.222534,381.034546 690.322571,387.102051 
	C684.241638,391.247681 676.767273,393.289490 670.362183,397.035034 
	C662.663940,401.536743 654.181519,402.747528 645.738281,403.841522 
	C639.512207,404.648254 633.083862,404.239136 626.774231,403.875854 
	C624.428528,403.740753 622.164062,402.194672 619.862549,401.291992 Z"/>''',
    "Association Area": '''<path d="
M533.021240,701.277954 
	C528.818359,699.926147 524.695984,698.145935 520.391113,697.336670 
	C515.576782,696.431702 510.603577,696.275146 505.687714,696.028198 
	C496.976624,695.590698 488.166321,695.988464 479.566193,694.808044 
	C471.325989,693.677002 463.310699,690.939880 455.173859,689.003967 
	C452.500458,688.367920 449.632477,688.382874 447.068970,687.484985 
	C440.958923,685.344666 435.041229,682.648682 428.911072,680.575806 
	C426.601685,679.794861 423.841919,680.431824 421.431885,679.837158 
	C419.277740,679.305542 417.368042,677.855530 415.271240,677.006531 
	C406.892578,673.614258 398.294891,670.692932 390.153046,666.811279 
	C384.991608,664.350342 380.667053,660.183838 375.624329,657.404175 
	C372.933929,655.921204 369.199127,654.543457 366.490601,655.248840 
	C360.538300,656.799011 357.376923,652.773804 353.703979,650.094360 
	C350.392090,647.678345 348.075104,643.942749 344.917297,641.262939 
	C335.906647,633.616211 330.103485,623.904785 325.954498,613.043335 
	C324.918518,610.331238 323.962524,607.588684 322.968994,604.048096 
	C323.974030,600.416077 325.104126,597.633179 325.959412,594.768250 
	C327.689789,588.972168 329.512695,583.186401 330.850586,577.294922 
	C332.404602,570.451416 335.328247,564.051086 335.342590,556.641724 
	C335.351837,551.880798 337.693451,546.350830 340.722260,542.544250 
	C345.698547,536.290039 351.975983,531.040588 357.898865,525.577942 
	C364.840302,519.175842 369.228638,511.567108 370.396362,502.179474 
	C372.746979,503.157257 375.308868,505.261200 376.665985,504.657349 
	C382.696716,501.974030 388.363373,498.479401 394.210052,495.369080 
	C395.260132,494.810394 396.520569,494.568298 397.715363,494.382721 
	C398.924591,494.194916 400.466461,494.711975 401.355042,494.136505 
	C406.101471,491.062408 410.834686,487.929199 415.284668,484.448425 
	C418.742706,481.743500 421.541107,478.170746 425.083832,475.607178 
	C427.552704,473.820648 430.133270,472.710083 430.117523,469.041504 
	C430.113098,468.012024 431.210999,466.811523 432.076721,465.971100 
	C438.630035,459.608673 445.251404,453.316406 452.289825,446.583008 
	C457.166412,448.309631 462.673981,445.377838 466.270081,440.462646 
	C466.858093,441.041382 467.355103,441.342438 467.852142,441.643494 
	C469.075226,441.622131 469.925201,443.443054 470.529724,443.364929 
	C473.671448,442.958923 476.930023,442.484680 479.806793,441.243561 
	C483.519379,439.641815 486.708740,436.736725 490.478271,435.376038 
	C499.190765,432.231079 508.117065,429.678345 516.852905,426.918182 
	C516.972839,424.783478 517.059937,423.232574 517.167786,421.312164 
	C518.570557,423.430176 519.726013,425.174835 521.044434,427.165558 
	C523.088318,424.642700 524.971130,422.318604 527.047241,420.341980 
	C529.481995,424.887054 533.288574,422.932098 536.351196,422.660919 
	C542.933228,422.078064 549.463013,420.905762 556.014893,419.979980 
	C560.339600,419.368896 564.665527,418.766937 568.993774,418.573700 
	C570.465698,424.171448 571.367554,429.608429 573.533752,434.483643 
	C576.985168,442.251343 576.735962,450.139587 575.273865,458.008453 
	C574.225525,463.651184 575.398071,467.496735 580.259705,468.473999 
	C583.813660,469.188416 587.466125,469.400116 591.062134,469.922211 
	C595.738708,470.601135 600.734680,470.546539 604.999268,472.273926 
	C612.480286,475.304138 619.509827,479.448944 626.821777,483.482819 
	C626.982727,484.331757 626.897339,485.156769 627.140564,485.268921 
	C632.436096,487.710327 630.016113,491.359985 628.986572,495.080231 
	C627.704834,499.711670 626.772400,504.470734 626.154785,509.235016 
	C625.982605,510.563721 627.116943,512.976501 628.228149,513.408020 
	C635.335205,516.168213 642.474792,519.972595 649.851135,520.622009 
	C658.768311,521.407104 665.043945,525.489441 670.623047,531.393311 
	C675.845093,536.919434 680.442078,543.031738 685.426636,548.788696 
	C687.827026,551.561096 691.592773,553.684753 692.805481,556.844727 
	C695.628784,564.201660 702.090149,567.832764 707.648865,571.725830 
	C717.400696,578.555481 729.768616,577.859863 741.034241,579.631531 
	C748.934753,580.873962 757.388916,578.013489 765.575745,578.154358 
	C777.618286,578.361572 789.222778,576.268311 800.828186,573.617859 
	C803.855713,572.926575 807.038940,572.778625 809.968811,571.823425 
	C819.571106,568.692932 829.097534,565.328247 838.634216,561.999329 
	C840.697266,561.279175 844.219849,562.367981 843.761292,558.118958 
	C843.738831,557.910889 845.786865,556.996582 846.186768,557.303223 
	C849.073059,559.516602 850.980652,556.883423 853.012634,555.921936 
	C858.762207,553.201294 857.296692,547.941040 857.397766,543.133301 
	C862.357788,546.684814 866.484070,551.366394 871.666504,553.627136 
	C880.907471,557.658447 889.303894,563.533752 899.359070,565.917114 
	C903.977600,567.011841 907.998169,570.968506 912.599365,571.711731 
	C918.533142,572.670227 924.776794,571.659607 930.887939,571.605835 
	C932.551758,571.591125 934.219055,571.967163 935.691650,572.494751 
	C930.628113,573.212769 925.761230,573.824585 920.885864,573.903076 
	C917.950500,573.950317 916.020752,574.425537 914.670471,577.446106 
	C912.978638,581.230713 911.303711,585.618958 908.269348,588.078430 
	C902.643433,592.638306 896.464417,597.218506 889.739136,599.557251 
	C879.238403,603.208862 870.129089,610.283142 858.648926,611.564636 
	C854.498047,612.028015 850.506409,614.289490 846.542908,615.968323 
	C841.296143,618.190613 836.123413,620.593628 830.963989,623.015015 
	C824.015442,626.276062 817.243713,629.971130 810.114563,632.760315 
	C807.546753,633.765015 805.155212,633.950317 804.341614,637.074402 
	C804.154053,637.794617 802.493652,638.856750 802.394653,638.768616 
	C799.731079,636.398010 798.221985,638.746094 795.834229,639.594971 
	C786.484619,642.918823 776.804626,645.329712 767.205933,647.926636 
	C764.157715,648.751282 760.987488,649.141724 757.861023,649.657654 
	C747.097351,651.433899 736.280090,652.929932 725.576050,655.010071 
	C716.451416,656.783264 706.552002,654.118164 698.110840,659.788025 
	C697.743469,660.034790 697.136414,659.906860 696.648438,659.994507 
	C687.693359,661.602539 678.461304,659.922607 669.546387,663.659912 
	C663.403931,666.234985 656.282471,666.534485 649.564758,667.646606 
	C647.089783,668.056396 644.517822,667.880005 641.546509,667.947388 
	C636.916504,668.997498 632.734924,670.090576 628.540955,671.134094 
	C627.120300,671.487671 625.664551,671.978943 624.231628,671.957275 
	C617.193176,671.850891 611.904358,675.914978 606.190552,679.123413 
	C600.759460,682.173096 597.144348,688.864868 589.243896,687.282227 
	C587.724365,686.977783 585.772461,689.407654 583.880493,690.270386 
	C579.508789,692.263794 575.168152,694.463318 570.589905,695.819641 
	C567.288208,696.797852 563.539734,696.178345 560.142151,696.944031 
	C555.502563,697.989685 550.909912,699.434509 546.503906,701.218872 
	C545.014160,701.822327 544.083374,703.929932 543.027161,705.440979 
	C542.166260,706.672607 541.499268,708.039856 541.417297,708.182129 
	C538.299744,705.618530 535.660522,703.448242 533.021240,701.277954 Z"/>''',
    "Visual Area": '''<path d="
M852.895386,212.031357 
	C842.580933,206.080399 831.535583,202.536530 819.607239,201.828827 
	C809.943726,201.255463 800.255981,199.851486 790.630981,200.210159 
	C780.714783,200.579712 770.840393,202.499207 760.991638,204.024490 
	C757.258606,204.602631 753.648315,205.973236 749.172607,206.953842 
	C742.662781,206.006027 744.379150,201.379456 743.841370,197.879700 
	C746.101868,192.608414 748.349487,187.331512 750.636169,182.071609 
	C750.997559,181.240417 751.924744,180.487213 751.927246,179.695801 
	C751.941833,175.171677 755.612122,173.106430 758.515320,171.450821 
	C762.011902,169.456802 766.372314,168.213715 770.403625,168.088318 
	C777.651550,167.862869 781.918762,163.310806 785.418091,158.343857 
	C787.815613,154.940796 787.948853,150.033356 789.712708,146.073898 
	C793.223267,138.193390 796.800964,130.120865 806.349792,127.687340 
	C812.918030,126.013397 819.546143,124.574020 826.547607,122.957100 
	C831.634094,124.261734 836.246094,126.025055 841.020630,126.944069 
	C855.342651,129.700760 867.110901,137.350128 878.488403,145.838608 
	C882.633240,148.930954 886.709961,152.114563 891.091675,155.456390 
	C895.629211,159.314590 899.960571,162.897644 904.140930,166.648849 
	C910.445801,172.306412 917.402222,177.462097 922.712036,183.951752 
	C930.680176,193.690536 938.686340,202.618408 952.545288,203.945877 
	C953.356750,206.354691 954.115906,208.968399 949.927612,207.479858 
	C948.867188,207.102997 947.669312,207.039474 946.527222,206.983383 
	C944.898071,206.903381 943.262085,206.963028 940.652588,206.963028 
	C940.043884,211.918488 939.578003,216.605545 938.869690,221.255646 
	C937.944153,227.331055 936.847107,232.919525 932.456909,238.220230 
	C928.163208,243.404388 926.693665,250.844482 923.507690,257.049561 
	C919.264160,265.314331 913.008118,272.056335 906.159119,278.269867 
	C904.865112,279.443878 904.054016,281.171082 902.713196,282.267914 
	C900.567200,284.023407 898.164490,285.465088 895.495239,287.098206 
	C892.712219,287.103790 890.304138,287.050568 887.131348,286.865417 
	C883.396179,285.572784 883.122253,283.625824 883.449219,280.506805 
	C883.949646,275.733124 883.307495,270.839661 883.150391,265.997040 
	C881.737183,258.219574 880.448059,250.416229 878.836792,242.680023 
	C878.339539,240.292740 876.963867,238.088455 875.845703,235.186035 
	C875.554199,234.268311 875.321167,234.062210 875.002014,233.953384 
	C875.002014,233.953384 875.028259,233.979660 875.045044,233.618561 
	C873.300049,229.441101 872.484314,224.950043 867.867310,223.170120 
	C867.867310,223.170120 867.879517,223.137634 867.816040,222.779816 
	C866.455017,221.338943 865.157410,220.255890 863.859802,219.172852 
	C863.859802,219.172867 863.867493,219.138992 863.803711,218.780823 
	C860.125122,216.292221 856.510254,214.161789 852.895386,212.031357 Z"/>''',
    "Motor Functions (Cerebellum)": '''<path d="
M935.691650,572.494751 
	C936.140686,572.170471 936.396545,572.177063 937.309570,572.507996 
	C947.616577,572.724487 957.266846,572.640198 966.916199,572.496094 
	C970.259521,572.446106 973.600525,572.247803 976.942627,572.117249 
	C991.550049,572.780762 1006.162170,573.356628 1020.763184,574.139648 
	C1029.926270,574.630920 1039.064575,575.665344 1048.230469,575.992859 
	C1052.449219,576.143616 1056.707397,575.183228 1061.072388,574.713257 
	C1061.398071,575.225037 1062.285645,576.619690 1063.505371,577.997925 
	C1065.865356,583.957581 1067.566406,590.070251 1069.997803,595.877258 
	C1073.621826,604.532776 1071.151611,613.144653 1070.215698,621.690308 
	C1069.759033,625.859436 1067.479248,629.834045 1065.989746,633.883911 
	C1061.558105,645.933716 1053.872803,655.985901 1046.371582,666.189087 
	C1043.440186,670.176270 1040.845337,674.246826 1040.698120,679.851013 
	C1040.589844,683.970215 1038.359253,688.223999 1036.382324,692.061218 
	C1033.014404,698.598267 1029.671509,704.965820 1028.170410,712.368774 
	C1027.480835,715.770020 1024.093262,718.718140 1021.666870,721.654968 
	C1015.241699,729.431641 1008.984314,737.382019 1002.086670,744.724609 
	C992.644287,754.776306 983.602356,765.285950 970.968689,771.874023 
	C963.558594,775.738220 956.779114,780.806152 949.669128,785.258057 
	C948.726013,785.848633 947.506470,785.997803 945.825195,786.648315 
	C944.060852,787.884521 942.886169,788.823792 941.711548,789.763000 
	C941.052490,789.860840 940.393494,789.958618 939.025024,790.075806 
	C936.214722,791.089844 934.113892,792.084473 932.013000,793.079102 
	C931.589539,793.119446 931.166077,793.159790 930.041260,793.213013 
	C923.233276,794.867310 917.126709,796.508789 911.020081,798.150269 
	C909.985046,798.194153 908.949951,798.238037 907.119690,798.311218 
	C902.516113,798.570618 898.687805,798.641785 894.910034,799.115479 
	C893.552124,799.285645 892.315674,800.424805 891.023865,801.121826 
	C890.294006,801.147217 889.564087,801.172607 888.010132,801.153320 
	C882.748962,801.194946 878.311890,801.281250 873.874817,801.367493 
	C873.150269,801.293335 872.425659,801.219177 871.197266,800.764038 
	C868.888489,799.918030 867.107849,799.285156 865.274048,799.019775 
	C859.883667,798.239868 854.441711,797.783997 849.077148,796.866638 
	C843.312805,795.880981 837.613342,794.515564 831.885559,793.315918 
	C831.165039,793.221924 830.444580,793.127991 829.269043,792.678467 
	C819.801025,789.234558 810.970886,785.322876 801.727905,783.270142 
	C790.652039,780.810303 781.673096,774.591736 772.165466,769.268555 
	C766.855713,766.295837 762.021973,762.472961 756.973694,759.033142 
	C756.973694,759.033142 757.000000,759.000000 756.870605,758.689209 
	C752.012817,755.756287 747.284424,753.134155 742.218384,750.243469 
	C741.199402,748.045959 741.095886,745.283813 739.732666,744.338745 
	C734.958191,741.028625 729.971375,737.833496 724.660034,735.528503 
	C713.014954,730.474976 701.377808,725.447632 691.173889,717.782715 
	C687.153259,714.762573 682.519165,712.061035 681.429016,706.299744 
	C681.251770,705.363159 679.241333,704.043945 678.168518,704.123230 
	C670.447998,704.693909 667.027039,699.013611 662.869507,694.214233 
	C661.698364,692.862244 659.710510,690.981934 658.406860,691.199524 
	C653.374878,692.039124 650.828003,688.721497 648.041870,685.833801 
	C646.022339,683.740662 644.138611,681.415710 642.672241,678.914001 
	C640.666626,675.492188 637.711182,671.883484 641.990051,667.970947 
	C644.517822,667.880005 647.089783,668.056396 649.564758,667.646606 
	C656.282471,666.534485 663.403931,666.234985 669.546387,663.659912 
	C678.461304,659.922607 687.693359,661.602539 696.648438,659.994507 
	C697.136414,659.906860 697.743469,660.034790 698.110840,659.788025 
	C706.552002,654.118164 716.451416,656.783264 725.576050,655.010071 
	C736.280090,652.929932 747.097351,651.433899 757.861023,649.657654 
	C760.987488,649.141724 764.157715,648.751282 767.205933,647.926636 
	C776.804626,645.329712 786.484619,642.918823 795.834229,639.594971 
	C798.221985,638.746094 799.731079,636.398010 802.394653,638.768616 
	C802.493652,638.856750 804.154053,637.794617 804.341614,637.074402 
	C805.155212,633.950317 807.546753,633.765015 810.114563,632.760315 
	C817.243713,629.971130 824.015442,626.276062 830.963989,623.015015 
	C836.123413,620.593628 841.296143,618.190613 846.542908,615.968323 
	C850.506409,614.289490 854.498047,612.028015 858.648926,611.564636 
	C870.129089,610.283142 879.238403,603.208862 889.739136,599.557251 
	C896.464417,597.218506 902.643433,592.638306 908.269348,588.078430 
	C911.303711,585.618958 912.978638,581.230713 914.670471,577.446106 
	C916.020752,574.425537 917.950500,573.950317 920.885864,573.903076 
	C925.761230,573.824585 930.628113,573.212769 935.691650,572.494751  Z"/>''',}

# --- Perform the one-time transformation of the SVG paths ---
DEFAULT_SHAPES = transform_svg_paths(ORIGINAL_SHAPES, target_width=400, target_height=300)

# This builder function is now ready to use the transformed shapes
def build_svg(activated_regions: list[str], region_data: dict, activated_color: str = "#FF4136"):
    """Constructs an SVG string with specified regions highlighted."""
    parts = [SVG_HEADER] # Removed BRAIN_OUTLINE because the new paths form their own outline
    for name, data in region_data.items():
        fill = activated_color if name in activated_regions else data['color']
        shape_svg = DEFAULT_SHAPES.get(name, '')
        if shape_svg:
            tooltip = f'<title>{name}</title>'
            parts.append(f'<g fill="{fill}" stroke="#333" stroke-width="0.5" style="transition: fill 0.3s ease;">{tooltip}{shape_svg}</g>')
    parts.append(SVG_FOOTER)
    return '\n'.join(parts)

# --- üöÄ Instantiate Mapper (Done once on startup) ---
# ... (The rest of your code is perfect and needs no changes) ...
try:
    mapper = BrainRegionMapper()
    MAPPER_LOADED = True
except Exception as e:
    print(f"FATAL: Could not load the GloVe model. The application will not work. Error: {e}")
    mapper = None
    MAPPER_LOADED = False

# --- ü§ñ Gradio Application Logic ---
def run_full_analysis(sentence, api_key):
    if not MAPPER_LOADED:
        raise gr.Error("The Brain Region Mapper could not be loaded. Please check the console for errors.")
    if not api_key:
        raise gr.Error("Google API Key is required. Please enter your key to proceed.")
    if not sentence or not sentence.strip():
        raise gr.Error("Please enter a sentence describing an activity.")

    try:
        genai.configure(api_key=api_key)
        gemini_model = genai.GenerativeModel("gemini-1.5-pro-latest")
    except Exception as e:
        raise gr.Error(f"Failed to configure Gemini. Please check your API key. Details: {e}")
    
    input_keywords = get_keywords_from_sentence(sentence, gemini_model)
    if not input_keywords or (len(input_keywords) == 1 and not input_keywords[0]):
        return "No keywords extracted.", build_svg([], mapper.region_data), "## Analysis Failed\nGemini did not return any keywords."
    
    keywords_output_str = ", ".join(input_keywords)
    top_regions = mapper.get_most_activated_regions(input_keywords, top_n=3)

    if isinstance(top_regions, str):
        error_msg = f"## üß† Brain Region Analysis\nAn error occurred: {top_regions}"
        return keywords_output_str, build_svg([], mapper.region_data), error_msg

    activated_region_names = [r['region'] for r in top_regions]
    svg_output = build_svg(activated_region_names, mapper.region_data)
    
    markdown_output = "## üß† Most Activated Brain Regions\n"
    emojis = ["ü•á", "ü•à", "ü•â"]
    for i, result in enumerate(top_regions):
        markdown_output += f"### {emojis[i]} {result['region']}\n"
        markdown_output += f"- **Lobe:** {result['lobe']}\n"
        markdown_output += f"- **Similarity Score:** {result['similarity_score']:.3f}\n"
        markdown_output += f"- **Display Color:** <span style='font-size: 1.5em; color: {result['color']};'>‚ñ†</span> `{result['color']}`\n\n---\n"
        
    return keywords_output_str, svg_output, markdown_output

# --- üé® Gradio Interface Definition ---
with gr.Blocks(theme=gr.themes.Soft(), title="Brain Activity Mapper") as demo:
    gr.Markdown(
        """
        # üß† Brain Activity Mapper
        This demo uses Gemini 1.5 Pro to map a described activity to potential brain regions.
        1.  **Enter an activity** (e.g., "Reading a book in a quiet library").
        2.  **Provide your Google AI Studio API Key**. You can get one [here](https://aistudio.google.com/app/apikey).
        3.  The app uses **Gemini** for keyword extraction and **GloVe word embeddings** for mapping.
        """
    )
    with gr.Row():
        with gr.Column(scale=1):
            api_key_input = gr.Textbox(label="üîë Google API Key", placeholder="Enter your Google AI Studio API Key...", type="password", value=os.environ.get("GOOGLE_API_KEY", ""))
            sentence_input = gr.Textbox(label="üìù Describe an Activity", placeholder="e.g., Listening to a speech and trying to understand its meaning.", lines=3)
            submit_btn = gr.Button("Analyze Activity", variant="primary")
            gr.Examples(
                examples=[
                    "Thinking about a complex plan while walking and keeping balance.",
                    "Looking at a colorful painting and feeling the texture of the canvas.",
                    "Speaking with a friend and understanding their response.",
                    "Playing the piano from sheet music.",
                    "Smelling a flower and remembering a childhood memory."
                ],
                inputs=sentence_input
            )
        with gr.Column(scale=2):
            keywords_output = gr.Textbox(label="üí° Extracted Keywords (from Gemini)", interactive=False)
            with gr.Tabs():
                with gr.TabItem("Visual Map"):
                    svg_map_output = gr.HTML(label="Brain Activity Map", value=build_svg([], mapper.region_data) if MAPPER_LOADED else "<div>Mapper failed to load.</div>")
                with gr.TabItem("Detailed Analysis"):
                    markdown_results_output = gr.Markdown(value="*Your analysis results will be displayed here.*")
    
    submit_btn.click(
        fn=run_full_analysis,
        inputs=[sentence_input, api_key_input],
        outputs=[keywords_output, svg_map_output, markdown_results_output],
        api_name="analyze"
    )

if __name__ == "__main__":
    demo.launch(debug=True)